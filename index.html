<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wall Mounted AR Shelf</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        body { margin: 0; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; background-color: #f0f0f0; }
        
        /* Control Panel */
        #controls { 
            background: white; 
            padding: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 10; 
            display: grid; 
            grid-template-columns: repeat(2, 1fr);
            gap: 10px; 
        }

        .full-width { grid-column: span 2; }
        
        label { font-size: 11px; color: #555; font-weight: bold; display: block; margin-bottom: 2px;}
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        button { 
            background: #2563eb; 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 6px; 
            font-size: 16px;
            font-weight: bold;
            margin-top: 5px;
        }

        #viewer-container { flex-grow: 1; position: relative; }
        model-viewer { width: 100%; height: 100%; --poster-color: #f0f0f0; }
        
        /* Placement Hint */
        #ar-hint {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            pointer-events: none;
            display: none; /* Shown via JS logic if needed */
        }
    </style>
</head>
<body>

    <div id="controls">
        <div>
            <label>Shelf Height (cm)</label>
            <input type="number" id="hInput" value="60">
        </div>
        <div>
            <label>Shelf Width (cm)</label>
            <input type="number" id="wInput" value="80">
        </div>
        <div>
            <label>Shelf Depth (cm)</label>
            <input type="number" id="dInput" value="25">
        </div>
        <div>
            <label>Number of Shelves</label>
            <input type="number" id="sInput" value="1">
        </div>
        
        <div class="full-width" style="background: #eef2ff; padding: 5px; border-radius: 4px; border: 1px dashed #2563eb;">
            <label style="color: #2563eb;">Elevation from Floor (cm)</label>
            <input type="number" id="elevationInput" value="120" style="border-color: #2563eb;">
        </div>

        <button class="full-width" onclick="generateShelf()">Generate Shelf</button>
    </div>

    <div id="viewer-container">
        <div id="ar-hint">Point camera at floor to detect height</div>
        <model-viewer 
            id="shelf-viewer"
            src="" 
            ar 
            ar-placement="floor"
            ar-modes="webxr scene-viewer quick-look" 
            camera-controls 
            shadow-intensity="1"
            auto-rotate>
        </model-viewer>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFExporter } from 'three/addons/exporters/GLTFExporter.js';

        const scene = new THREE.Scene();
        // Lighter wood color for visibility
        const material = new THREE.MeshStandardMaterial({ color: 0xD2B48C, roughness: 0.5 });

        window.generateShelf = function() {
            // 1. Get Inputs
            const h = parseFloat(document.getElementById('hInput').value) / 100; // convert cm to m
            const w = parseFloat(document.getElementById('wInput').value) / 100;
            const d = parseFloat(document.getElementById('dInput').value) / 100;
            const elevation = parseFloat(document.getElementById('elevationInput').value) / 100; // Elevation in m
            const shelvesCount = parseInt(document.getElementById('sInput').value);
            const thick = 0.02; // 2cm thickness

            scene.clear();

            // 2. Helper function to create parts
            // We add 'elevation' to every Y coordinate so the whole structure shifts up
            function createPart(bx, by, bz, x, y, z) {
                const geo = new THREE.BoxGeometry(bx, by, bz);
                const mesh = new THREE.Mesh(geo, material);
                // Important: Add elevation to the Y position
                mesh.position.set(x, y + elevation, z);
                scene.add(mesh);
            }

            // --- BUILD THE SHELF ---

            // Side Panels (Left & Right)
            // Their center Y is at h/2
            createPart(thick, h, d, -w/2 + thick/2, h/2, 0);
            createPart(thick, h, d, w/2 - thick/2, h/2, 0);

            // Top Panel
            createPart(w - thick*2, thick, d, 0, h - thick/2, 0);

            // Bottom Panel
            createPart(w - thick*2, thick, d, 0, thick/2, 0);

            // Middle Shelves
            if (shelvesCount > 0) {
                const internalHeight = h - (thick * 2);
                const spacing = internalHeight / (shelvesCount + 1);
                for(let i = 1; i <= shelvesCount; i++) {
                    createPart(w - thick*2, thick, d, 0, thick + (spacing * i), 0);
                }
            }

            // Back Panel (Thin)
            createPart(w, h, 0.005, 0, h/2, -d/2);


            // 3. EXPORT
            const exporter = new GLTFExporter();
            exporter.parse(scene, function (result) {
                const blob = new Blob([result], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                document.getElementById('shelf-viewer').src = url;
            }, { binary: true });
        };

        // Initialize on load
        window.addEventListener('load', generateShelf);
    </script>
</body>
</html>
